print 'CREATING <%= @ctx[:coh_server_name] %> COHERENCE SERVER';

connect('<%= node[:weblogic][:user] %>','<%= node[:weblogic][:password] %>','t3://<%= node[:weblogic][:domain_name] %>:<%= node[:weblogic][:port] %>')
edit()
startEdit()
cd('/')
cmo.createCoherenceServer('<%= @ctx[:coh_server_name] %>')
cd('/CoherenceServers/<%= @ctx[:coh_server_name] %>')
cmo.setMachine(getMBean('/Machines/<%= @ctx[:machine_name] %>'))
cmo.setUnicastListenAddress("<%= @ctx[:coh_server_unicast_address] %>")
cmo.setUnicastListenPort(<%= @ctx[:coh_server_unicast_port] %>)
cmo.setUnicastPortAutoAdjust(<%= @ctx[:coh_server_unicast_port_autoadjust] %>)
cd('/CoherenceServers/<%= @ctx[:coh_server_name] %>/CoherenceServerStart/<%= @ctx[:coh_server_name] %>')
cmo.setClassPath("<%= @ctx[:coh_server_classpath].map {|x| "#{node[:weblogic][:bea_home]}/#{x}"}.join(':') %>")
cmo.setArguments("<%= @ctx[:coh_server_arguments].join(' ') %>")
save()
activate()
cd('/')
domainRuntime()
cd('CoherenceServerLifeCycleRuntimes/<%= @ctx[:coh_server_name] %>')
cmo.start()
exit()
